#!/usr/bin/env bash

# Create a new directory and enter it
function mkd() {
	mkdir -p "$@" && cd "$_";
}

# Determine size of a file or total size of a directory
function fs() {
	if du -b /dev/null > /dev/null 2>&1; then
		local arg=-sbh;
	else
		local arg=-sh;
	fi
	if [[ -n "$@" ]]; then
		du $arg -- "$@";
	else
		du $arg .[^.]* ./*;
	fi;
}

function sumcol() {
  awk "{ SUM += \$${1} } END { print SUM }"
}


#########################
# pandoc
#########################
function md2pdf() {
	for file in "$@"; do pandoc "$file" -o "${file%.md}.pdf"; done
}

function md2html() {
	for file in "$@"; do pandoc "$file" -o "${file%.md}.html"; done
}

function mailattach() {
    
    if [ $# -gt 1 ]; then
    zip -r /tmp/attachment.zip $@
    ATTACHMENT="/tmp/attachment.zip"
    else
    ATTACHMENT=$1
    fi
    
    # send mail
    echo "message sent from the terminal using the function mailttach" | mailx -s "Subject: attachment incoming" -a $ATTACHMENT konrad.mayer@zamg.ac.at
}

#########################
# GIT
#########################
# from https://bezhermoso.github.io/2018/07/28/jump-back-up-to-git-repo-root-directory/
function jump-to-git-root {
  local _root_dir="$(git rev-parse --show-toplevel 2>/dev/null)"
  if [[ $? -gt 0 ]]; then
    >&2 echo 'Not a Git repo!'
    exit 1
  fi
  local _pwd=$(pwd)
  if [[ $_pwd = $_root_dir ]]; then
    # Handle submodules:
    # If parent dir is also managed under Git then we are in a submodule.
    # If so, cd to nearest Git parent project.
    _root_dir="$(git -C $(dirname $_pwd) rev-parse --show-toplevel 2>/dev/null)"
    if [[ $? -gt 0 ]]; then
      echo "Already at Git repo root."
      return 0
    fi
  fi
  # Make `cd -` work.
  OLDPWD=$_pwd
  echo "Git repo root: $_root_dir"
  cd $_root_dir
}

#########################
# docker
#########################
# from https://github.com/Bash-it/bash-it/blob/master/plugins/available/docker.plugin.bash
function docker-remove-most-recent-container() {
  docker ps -ql | xargs docker rm
}

function docker-remove-most-recent-image() {
  docker images -q | head -1 | xargs docker rmi
}

function docker-enter() {
  docker exec -it "$@" /bin/bash;
}
